#!/bin/sh
compare() {
    for i in *
    do
        if [ `du "$i" | cut -f1` -lt `du ../"$i" | cut -f1` ]
        then
            echo $i
            mv "$i" ../"$i"
        fi
    done
}

mkdir out
ls *.flac | parallel ffmpeg -hide_banner -i {} -c:v copy -c:a flac -compression_level 12 $@ out/{}
cd out
compare
cd ..
cp *.flac out
cd out
ls | parallel flac -f -8 -V {}
compare
cd ..
rm -r out

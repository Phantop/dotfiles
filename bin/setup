#!/bin/sh
# shellcheck disable=SC2086
set -e
alias s=sudo se="s dnf -y" g=git

gnome="clapper gnome-photos gnome-mpv gnome-terminal nautilus rhythmbox"
se remove $gnome firefox libreoffice onboard PackageKit-command-not-found thunderbird

pkgs="advancecomp aria2 audacious audacity autojump avidemux bleachbit bsdtar bzip3
caja ccache corectrl dolphin-emu engrampa fd-find fish fzf gifsicle gimp
git-credential-libsecret git-extras htop ifuse innoextract intel-clear-sans-fonts
jdupes jpegoptim keepassxc kernel-tools kitty libjxl-utils lynx megatools mkvtoolnix
moreutils mpv ncdu netsurf neovim nicotine+ nnn opus-tools oxipng p7zip pandoc
parallel pipx pngquant qt-creator qutebrowser python3-readability-lxml qrencode
ripgrep rofi sass shellcheck spectacle starship stow sxiv syncthing tig tlp tor
torsocks ubuntumono-nerd-fonts upx usbmuxd wimlib-utils yt-dlp zathura-pdf-mupdf
zathura-plugins-all"
se update; se install $pkgs

stow --no-folding -d ~/.dotfiles -t ~/.config .
rm ~/.gtkrc-2.0
ln -s ~/.config/gtk-3.0/gtkrc ~/.gtkrc-2.0
mkdir -p ~/.parallel/will-cite

wget https://github.com/dracula/rofi/raw/main/theme/config2.rasi -P ~/.config/rofi
wget https://github.com/dracula/kitty/raw/master/dracula.conf -P ~/.config/kitty
wget https://github.com/dracula/musikcube/raw/main/dracula.json -P ~/.config/musikcube/themes

wget https://github.com/mrzool/bash-sensible/raw/master/sensible.bash -O ~/.bashrc
wget https://github.com/savq/paq-nvim/raw/master/lua/paq.lua -P ~/.config/nvim/lua
wget https://source.netsurf-browser.org/netsurf.git/plain/resources/adblock.css\
    https://nitter.it/css/themes/dracula.css -P ~/.config/qutebrowser

q=qutebrowser; wget https://github.com/$q/$q/raw/master/misc/userscripts/readability\
    https://github.com/$q/$q/raw/master/misc/userscripts/qr -P ~/.config/$q/userscripts
chmod +x ~/.config/qutebrowser/userscripts/*

un(){ F=$(mktemp); mkdir -p "$2"; curl https://api.github.com/repos/"$1"/releases |\
      grep -om1 http.\*zip | wget -i- -O"$F"; unzip "$F" -d "$2";}
un bloc97/Anime4k ~/.config/mpv/shaders
un mozilla/pdf.js ~/.local/share/qutebrowser/pdfjs

chsh -s "$(which fish)"
fish -c "aliases;clean"

g g p:appdwarf ~/.appdwarf
g g p:phantop.github.io ~/.site
g g p:haiku-icons ~/.local/share/icons/Haiku
g g gh:dracula/gtk ~/.local/share/themes/dracula
nvim +PaqInstall +q

parallel gsettings set org.gnome.desktop.interface {}-theme Haiku ::: cursor icon
gsettings set org.gnome.desktop.interface gtk-theme dracula

for i in ~/.dotfiles/dconf/*; do
    dconf reset -f "$(basename $i | sed 's/^/./;s#\.#/#g;s#.toml#/#')"
    dconf load "$(basename $i | sed 's/^/./;s#\.#/#g;s#.toml#/#')" < "$i"
done
